{% extends "base.html" %}

{% block content %}
<div class="container mx-auto p-6">
    <!-- Back to Dashboard Link -->
    <div class="mb-4">
        <a href="{{ url_for('dashboard') }}" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
            ‚Üê Back to Dashboard
        </a>
    </div>
    
    <h1 class="text-2xl font-bold mb-6">Purchase Orders</h1>
    
    <div class="flex mb-4">
        <a href="{{ url_for('create_po') }}" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 mr-4">
            Create New PO
        </a>
        
        <div class="flex space-x-2">
            <a href="{{ url_for('purchase_orders', status='all') }}" 
               class="px-3 py-1 rounded {% if status == 'all' %}bg-gray-600{% else %}bg-gray-700{% endif %}">
                All
            </a>
            <a href="{{ url_for('purchase_orders', status='draft') }}" 
               class="px-3 py-1 rounded {% if status == 'draft' %}bg-gray-600{% else %}bg-gray-700{% endif %}">
                Draft
            </a>
            <a href="{{ url_for('purchase_orders', status='open') }}" 
               class="px-3 py-1 rounded {% if status == 'open' %}bg-gray-600{% else %}bg-gray-700{% endif %}">
                Open
            </a>
            <a href="{{ url_for('purchase_orders', status='pending') }}" 
               class="px-3 py-1 rounded {% if status == 'pending' %}bg-gray-600{% else %}bg-gray-700{% endif %}">
                Pending
            </a>
            <a href="{{ url_for('purchase_orders', status='paid') }}" 
               class="px-3 py-1 rounded {% if status == 'paid' %}bg-gray-600{% else %}bg-gray-700{% endif %}">
                Paid
            </a>
        </div>
    </div>
    
    <table class="w-full border-collapse">
        <thead>
            <tr class="bg-gray-600">
                <th class="p-3 text-left">PO #</th>
                <th class="p-3 text-left">Distributor</th>
                <th class="p-3 text-left">Date</th>
                <th class="p-3 text-left">Status</th>
                <th class="p-3 text-right">Total</th>
                <th class="p-3 text-left">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for po in pos.items %}
            <tr class="border-b border-gray-600 hover:bg-gray-700">
                <td class="p-3">{{ po.po_number }}</td>
                <td class="p-3">{{ po.distributor.name }}</td>
                <td class="p-3">{{ po.order_date.strftime('%Y-%m-%d') }}</td>
                <td class="p-3">
                    <span class="px-2 py-1 rounded 
                        {% if po.status == 'draft' %}bg-gray-500
                        {% elif po.status == 'open' %}bg-blue-500
                        {% elif po.status == 'pending' %}bg-yellow-500
                        {% elif po.status == 'paid' %}bg-green-500
                        {% endif %}">
                        {{ po.status|title }}
                    </span>
                </td>
                <td class="p-3 text-right">${{ "{:,.2f}".format(po.total_amount) }}</td>
                <td class="p-3">
    <a href="{{ url_for('edit_po', po_id=po.id) }}" class="text-blue-400 hover:text-blue-300 mr-2">Edit</a>
    <a href="{{ url_for('export_po', po_id=po.id, format='pdf') }}" class="text-red-400 hover:text-red-300 mr-2">PDF</a>
    <a href="{{ url_for('export_po', po_id=po.id, format='csv') }}" class="text-green-400 hover:text-green-300 mr-2">CSV</a>
    <form method="POST" action="{{ url_for('delete_po', po_id=po.id) }}" class="inline">
        <button type="submit" class="text-red-600 hover:text-red-500" 
                onclick="return confirm('Are you sure you want to delete this PO?')">
            Delete
        </button>
    </form>
</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <div class="mt-4 flex justify-center">
        {% if pos.has_prev %}
        <a href="{{ url_for('purchase_orders', page=pos.prev_num, status=status) }}" class="px-3 py-1 bg-gray-700 rounded mr-2">Previous</a>
        {% endif %}
        
        {% for page_num in pos.iter_pages() %}
            {% if page_num %}
                <a href="{{ url_for('purchase_orders', page=page_num, status=status) }}" 
                   class="px-3 py-1 {% if page_num == pos.page %}bg-gray-600{% else %}bg-gray-700{% endif %} rounded mr-2">
                    {{ page_num }}
                </a>
            {% else %}
                <span class="px-3 py-1">...</span>
            {% endif %}
        {% endfor %}
        
        {% if pos.has_next %}
        <a href="{{ url_for('purchase_orders', page=pos.next_num, status=status) }}" class="px-3 py-1 bg-gray-700 rounded ml-2">Next</a>
        {% endif %}
    </div>
</div>
{% endblock %}